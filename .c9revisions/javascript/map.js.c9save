{"ts":1353354396404,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"  dojo.require(\"esri.map\");\n  dojo.require(\"esri.dijit.Legend\");\n  dojo.require(\"esri.dijit.Scalebar\");\n  dojo.require(\"esri.arcgis.utils\");\n  dojo.require(\"esri.IdentityManager\");\n  dojo.require(\"dijit.dijit\");\n  dojo.require(\"dijit.layout.BorderContainer\");\n  dojo.require(\"dijit.layout.ContentPane\");\n  dojo.require(\"dijit.layout.StackContainer\");\n  \n  \n  \n     var map, urlObjects;\n\t \n\t function initMap() {\n       patchID();\n      \n       if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\n         configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\n       }\n       esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);\n\n       if(!configOptions.sharingurl){\n         configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\n       }\n       esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\n       \n       if(!configOptions.proxyurl){   \n         configOptions.proxyurl = location.protocol + '//' + location.host + \"/sharing/proxy\";\n       }\n\n       esri.config.defaults.io.proxyUrl =  configOptions.proxyurl;\n\n       esri.config.defaults.io.alwaysUseProxy = false;\n      \n       urlObject = esri.urlToObject(document.location.href);\n       urlObject.query = urlObject.query || {};\n      \n       if(urlObject.query.title){\n         configOptions.title = urlObject.query.title;\n       }\n       if(urlObject.query.subtitle){\n         configOptions.title = urlObject.query.subtitle;\n       }\n       if(urlObject.query.webmap){\n         configOptions.webmap = urlObject.query.webmap;      \n       } \n       if(urlObject.query.bingMapsKey){\n         configOptions.bingmapskey = urlObject.query.bingMapsKey;      \n       }\n\n\t   esri.arcgis.utils.arcgisUrl = \"http://arcgis.com/sharing/content/items\";\t\n\t\t\n\t   var mapDeferred = esri.arcgis.utils.createMap(configOptions.webmap, \"map\", {\n         mapOptions: {\n           slider: true,\n           nav: false,\n           wrapAround180:true\n         },\n         ignorePopups:false,\n         bingMapsKey: configOptions.bingmapskey\n       });\n\n       mapDeferred.addCallback(function (response) {\n        \n\t\t document.title = configOptions.title|| response.itemInfo.item.title || \"\";\n         dojo.byId(\"title\").innerHTML = configOptions.title ||response.itemInfo.item.title;\n         dojo.byId(\"subtitle\").innerHTML = configOptions.subtitle|| response.itemInfo.item.snippet || \"\";\n        \n         map = response.map;\n\t\t\n\t\t dojo.connect(map,\"onUpdateEnd\",hideLoader);\n\t\t\n         var layers = response.itemInfo.itemData.operationalLayers;\n         if(map.loaded){\n           initUI(layers);\n         }\n         else{\n           dojo.connect(map,\"onLoad\",function(){\n             initUI(layers);\n           });\n         }\n         //resize the map when the browser resizes\n         dojo.connect(dijit.byId('map'), 'resize', map,map.resize);\n       });\n\n       mapDeferred.addErrback(function (error) {\n         alert(\"Unable to create map: \" + \" \" + dojo.toJson(error.message));\n       });\n\t   \n     }\n\n\n     function initUI(layers) {\n       //add chrome theme for popup\n       dojo.addClass(map.infoWindow.domNode, \"chrome\");\n       //add the scalebar \n       var scalebar = new esri.dijit.Scalebar({\n         map: map,\n         scalebarUnit:\"english\" //metric or english\n       }); \n\n       var layerInfo = buildLayersList(layers);\n      \n       if(layerInfo.length > 0){\n         var legendDijit = new esri.dijit.Legend({\n           map:map,\n           layerInfos:layerInfo\n         },\"legendDiv\");\n         legendDijit.startup();\n       }\n       else{\n         dojo.byId('legendDiv').innerHTML = '';\n       }\n     }\n\t \nfunction buildLayersList(layers) {\n    var layerInfo = [];\n    dojo.forEach(layers, function (mapLayer, index) {\n      if (mapLayer.featureCollection && !mapLayer.layerObject) {\n        if (mapLayer.featureCollection.layers && mapLayer.featureCollection) {\n          if (mapLayer.featureCollection.layers.length === 1) {\n            layerInfo.push({\n              \"layer\": mapLayer.featureCollection.layers[0].layerObject,\n              \"title\": mapLayer.title\n            });\n          } else {\n            dojo.forEach(mapLayer.featureCollection.layers, function (layer) {\n              layerInfo.push({\n                layer: layer.layerObject,\n                title: mapLayer.title\n              });\n            });\n          }\n        }\n      } else if (mapLayer.layerObject) {\n        layerInfo.push({\n          layer: mapLayer.layerObject,\n          title: mapLayer.title\n        });\n      }\n    });\n    return layerInfo;\n  }\n    \n     function patchID() {  //patch id manager for use in apps.arcgis.com\n       esri.id._isIdProvider = function(server, resource) {\n       // server and resource are assumed one of portal domains\n \n       var i = -1, j = -1;\n \n       dojo.forEach(this._gwDomains, function(domain, idx) {\n         if (i === -1 && domain.regex.test(server)) {\n           i = idx;\n         }\n         if (j === -1 && domain.regex.test(resource)) {\n           j = idx;\n         }\n       });\n \n       var retVal = false;\n   \n       if (i > -1 && j > -1) {\n         if (i === 0 || i === 4) {\n           if (j === 0 || j === 4) {\n             retVal = true;\n           }\n         }\n         else if (i === 1) {\n           if (j === 1 || j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 2) {\n           if (j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 3) {\n           if (j === 3) {\n             retVal = true;\n           }\n         }\n       }\n \n       return retVal;\n     };    \n    }\n\t\n\tfunction hideLoader(){\n\t  $(\"#loadingCon\").hide();\n\t}\n\t\n\t//Jquery Layout\n\t$(document).ready(function(e) {\n\t  $(\"#legendToggle\").click(function(){\n\t\tif ($(\"#legendDiv\").css('display')=='none'){\n\t\t  $(\"#legTogText\").html('MAP LEGEND ▲');\n\t\t}\n\t\telse{\n\t\t  $(\"#legTogText\").html('MAP LEGEND ▼');\n\t\t}\n\t\t$(\"#legendDiv\").slideToggle();\n\t  });\n    });"]],"start1":0,"start2":0,"length1":0,"length2":6054}]],"length":6054}
{"contributors":[],"silentsave":true,"ts":1353354512367,"patch":[[{"diffs":[[0,": true,\n"],[1,"           sl\n"],[0,"        "]],"start1":1986,"start2":1986,"length1":16,"length2":30}]],"length":6068,"saved":false}
{"ts":1353354513705,"patch":[[{"diffs":[[0,"      sl"],[1,"ider"],[0,"\n       "]],"start1":1999,"start2":1999,"length1":16,"length2":20}]],"length":6072,"saved":false}
{"ts":1353354515375,"patch":[[{"diffs":[[0,"  slider"],[1,"Style"],[0,"\n       "]],"start1":2003,"start2":2003,"length1":16,"length2":21}]],"length":6077,"saved":false}
{"ts":1353354517000,"patch":[[{"diffs":[[0,"derStyle"],[1,":"],[0,"\n       "]],"start1":2008,"start2":2008,"length1":16,"length2":17}]],"length":6078,"saved":false}
{"ts":1353354519185,"patch":[[{"diffs":[[0,"erStyle:"],[1,"\"small\""],[0,"\n       "]],"start1":2009,"start2":2009,"length1":16,"length2":23}]],"length":6085,"saved":false}
{"ts":1353354519589,"patch":[[{"diffs":[[0,"iner\");\n"],[-1,"  \n  \n  "],[1,"\n\n"],[0,"\n     va"]],"start1":343,"start2":343,"length1":24,"length2":18},{"diffs":[[0,"bjects;\n"],[-1,"\t "],[0,""],[1,""],[0,"\n\t funct"]],"start1":372,"start2":372,"length1":18,"length2":16},{"diffs":[[0,"chID();\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":414,"start2":414,"length1":22,"length2":16},{"diffs":[[0,"ingurl;\n"],[-1,"       "],[0,"\n       "]],"start1":935,"start2":935,"length1":23,"length2":16},{"diffs":[[0,"oxyurl){"],[-1,"   "],[0,"\n       "]],"start1":971,"start2":971,"length1":19,"length2":16},{"diffs":[[0," false;\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":1200,"start2":1200,"length1":22,"length2":16},{"diffs":[[0," || {};\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":1310,"start2":1310,"length1":22,"length2":16},{"diffs":[[0,".webmap;"],[-1,"      "],[0,"\n       "]],"start1":1601,"start2":1601,"length1":22,"length2":16},{"diffs":[[0,"       }"],[-1," "],[0,"\n       "]],"start1":1610,"start2":1610,"length1":17,"length2":16},{"diffs":[[0,"MapsKey;"],[-1,"      "],[0,"\n       "]],"start1":1716,"start2":1716,"length1":22,"length2":16},{"diffs":[[0,"/items\";"],[-1,"\t\n\t\t"],[1,"\n"],[0,"\n\t   var"]],"start1":1803,"start2":1803,"length1":20,"length2":17},{"diffs":[[0,"onse) {\n"],[-1,"        "],[0,""],[1,""],[0,"\n\t\t docu"]],"start1":2172,"start2":2172,"length1":24,"length2":16},{"diffs":[[0," || \"\";\n"],[-1,"        "],[0,""],[1,""],[0,"\n       "]],"start1":2449,"start2":2449,"length1":24,"length2":16},{"diffs":[[0,"se.map;\n"],[-1,"\t\t"],[0,""],[1,""],[0,"\n\t\t dojo"]],"start1":2479,"start2":2479,"length1":18,"length2":16},{"diffs":[[0,"oader);\n"],[-1,"\t\t"],[0,""],[1,""],[0,"\n       "]],"start1":2527,"start2":2527,"length1":18,"length2":16},{"diffs":[[0,"    });\n"],[-1,"\t   "],[0,""],[1,""],[0,"\n     }\n"]],"start1":3046,"start2":3046,"length1":20,"length2":16},{"diffs":[[0,"scalebar"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":3204,"start2":3204,"length1":17,"length2":16},{"diffs":[[0,"     });"],[-1," "],[0,""],[1,""],[0,"\n\n      "]],"start1":3334,"start2":3334,"length1":17,"length2":16},{"diffs":[[0,"ayers);\n"],[-1,"      "],[0,""],[1,""],[0,"\n       "]],"start1":3384,"start2":3384,"length1":22,"length2":16},{"diffs":[[0,"\n     }\n"],[-1,"\t "],[0,""],[1,""],[0,"\nfunctio"]],"start1":3664,"start2":3664,"length1":18,"length2":16},{"diffs":[[0,"fo;\n  }\n"],[-1,"    "],[0,""],[1,""],[0,"\n     fu"]],"start1":4598,"start2":4598,"length1":20,"length2":16},{"diffs":[[0,"domains\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":4796,"start2":4796,"length1":17,"length2":16},{"diffs":[[0,"j = -1;\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":4824,"start2":4824,"length1":17,"length2":16},{"diffs":[[0,"    });\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":5069,"start2":5069,"length1":17,"length2":16},{"diffs":[[0," false;\n"],[-1,"   "],[0,""],[1,""],[0,"\n       "]],"start1":5097,"start2":5097,"length1":19,"length2":16},{"diffs":[[0,"      }\n"],[-1," "],[0,""],[1,""],[0,"\n       "]],"start1":5594,"start2":5594,"length1":17,"length2":16},{"diffs":[[0,"  };"],[-1,"    "],[0,""],[1,""],[0,"\n    }\n"],[-1,"\t"],[0,""],[1,""],[0,"\n\tfu"]],"start1":5628,"start2":5628,"length1":20,"length2":15},{"diffs":[[0,"e();\n\t}\n"],[-1,"\t"],[0,"\n\t//Jque"]],"start1":5687,"start2":5687,"length1":17,"length2":16}]],"length":5982,"saved":false}
{"ts":1353354557421,"patch":[[{"diffs":[[0,":\"small\""],[1,","],[0,"\n       "]],"start1":1964,"start2":1964,"length1":16,"length2":17}]],"length":5983,"saved":false}
{"ts":1353356703729,"patch":[[{"diffs":[[0,"initUI(layers);\n"],[1,"           initApp();\n"],[0,"         }\n     "]],"start1":2641,"start2":2641,"length1":32,"length2":54}]],"length":6005,"saved":false}
{"ts":1353356706052,"patch":[[{"diffs":[[0,"initUI(layers);\n"],[1,"             initApp();\n"],[0,"           });\n "]],"start1":2767,"start2":2767,"length1":32,"length2":56}]],"length":6029,"saved":false}
{"contributors":[],"silentsave":true,"ts":1353362225048,"patch":[[{"diffs":[[0,"});\n\n       "],[1,"//"],[0,"var layerInf"]],"start1":3386,"start2":3386,"length1":24,"length2":26}]],"length":6031,"saved":false}
{"ts":1353362235468,"patch":[[{"diffs":[[0,"\n       "],[-1,"//"],[0,"var laye"]],"start1":3390,"start2":3390,"length1":18,"length2":16}]],"length":6029,"saved":false}
{"ts":1353362251290,"patch":[[{"diffs":[[0,"lish\n       });\n"],[1,"        /"],[0,"\n       var laye"]],"start1":3374,"start2":3374,"length1":32,"length2":41}]],"length":6038,"saved":false}
{"ts":1353362251539,"patch":[[{"diffs":[[0,"       /"],[1,"*"],[0,"\n       "]],"start1":3391,"start2":3391,"length1":16,"length2":17}]],"length":6039,"saved":false}
{"ts":1353362254870,"patch":[[{"diffs":[[0,"';\n       }\n"],[1,"       */\n"],[0,"     }\n\nfunc"]],"start1":3710,"start2":3710,"length1":24,"length2":34}]],"length":6049,"saved":false}
{"ts":1353367484270,"patch":[[{"diffs":[[0,"180:true"],[1,",\n           l"],[0,"\n       "]],"start1":2018,"start2":2018,"length1":16,"length2":30}]],"length":6063,"saved":false}
{"ts":1353367485876,"patch":[[{"diffs":[[0,"       l"],[1,"ods"],[0,"\n       "]],"start1":2032,"start2":2032,"length1":16,"length2":19}]],"length":6066,"saved":false}
{"ts":1353367486941,"patch":[[{"diffs":[[0,"    lods"],[1,":"],[0,"\n       "]],"start1":2035,"start2":2035,"length1":16,"length2":17}]],"length":6067,"saved":false}
{"ts":1353367488454,"patch":[[{"diffs":[[0,"   lods:"],[1,"lods"],[0,"\n       "]],"start1":2036,"start2":2036,"length1":16,"length2":20}]],"length":6071,"saved":false}
{"ts":1353367495489,"patch":[[{"diffs":[[0,"/items\";"],[1,"\n       \n       var "],[0,"\n\n\t   va"]],"start1":1803,"start2":1803,"length1":16,"length2":36}]],"length":6091,"saved":false}
{"ts":1353367496721,"patch":[[{"diffs":[[0,"    var "],[1,"lods"],[0,"\n\n\t   va"]],"start1":1823,"start2":1823,"length1":16,"length2":20}]],"length":6095,"saved":false}
{"ts":1353367508111,"patch":[[{"diffs":[[0,"var lods"],[1," = [\n          {\"level\" : 0, \"resolution\" : 9783.93962049996, \"scale\" : 36978595.474472},\n  \t\t{\"level\" : 1, \"resolution\" : 4891.96981024998, \"scale\" : 18489297.737236},\n        {\"level\" : 2, \"resolution\" : 2445.98490512499, \"scale\" : 9244648.868618},\n        {\"level\" : 3, \"resolution\" : 1222.99245256249, \"scale\" : 4622324.434309},\n      \t{\"level\" : 4, \"resolution\" : 611.49622628138, \"scale\" : 2311162.217155},\n        {\"level\" : 5, \"resolution\" : 305.748113140558, \"scale\" : 1155581.108577}\n    ];"],[0,"\n\n\t   va"]],"start1":1827,"start2":1827,"length1":16,"length2":516}]],"length":6595,"saved":false}
{"ts":1353367508420,"patch":[[{"diffs":[[0,"items\";\n"],[-1,"       "],[0,"\n       "]],"start1":1804,"start2":1804,"length1":23,"length2":16}]],"length":6588,"saved":false}
{"ts":1353367511831,"patch":[[{"diffs":[[0,"2},\n  \t\t"],[1,"  "],[0,"{\"level\""]],"start1":1914,"start2":1914,"length1":16,"length2":18}]],"length":6590,"saved":false}
{"ts":1353367514256,"patch":[[{"diffs":[[0,"37236},\n        "],[1,"    "],[0,"{\"level\" : 2, \"r"]],"start1":1991,"start2":1991,"length1":32,"length2":36}]],"length":6594,"saved":false}
{"ts":1353367515663,"patch":[[{"diffs":[[0,"236},\n          "],[-1,"  "],[0,"{\"level\" : 2, \"r"]],"start1":1993,"start2":1993,"length1":34,"length2":32}]],"length":6592,"saved":false}
{"ts":1353367516699,"patch":[[{"diffs":[[0,"68618},\n        "],[1,"  "],[0,"{\"level\" : 3, \"r"]],"start1":2075,"start2":2075,"length1":32,"length2":34}]],"length":6594,"saved":false}
{"ts":1353367518956,"patch":[[{"diffs":[[0,"\n      \t"],[1,"  "],[0,"{\"level\""]],"start1":2166,"start2":2166,"length1":16,"length2":18},{"diffs":[[0,"17155},\n"],[1,"  "],[0,"        "]],"start1":2241,"start2":2241,"length1":16,"length2":18}]],"length":6598,"saved":false}
{"ts":1353367520859,"patch":[[{"diffs":[[0,"108577}\n"],[1,"    "],[0,"    ];\n\n"]],"start1":2324,"start2":2324,"length1":16,"length2":20}]],"length":6602,"saved":false}
